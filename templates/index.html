<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Bug Triage Agent</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="static/style.css">
    
</head>
<body>
    <div class="container">
        <h2><i class="fas fa-bug"></i> AI Bug Triage Agent</h2>
        <form id="bugForm" method="post">
            <div class="form-group">
                <label for="title">Bug Title</label>
                <div class="input-group">
                    <i class="fas fa-tag"></i>
                    <input type="text" id="title" name="title" required placeholder="Enter a concise bug title">
                </div>
                <div class="error" id="titleError">Bug title is required.</div>
            </div>
            <div class="form-group">
                <label for="history">Issue History</label>
                <div class="input-group">
                    <i class="fas fa-history"></i>
                    <textarea id="history" name="history" rows="5" placeholder="Describe the issue history, steps to reproduce, etc."></textarea>
                </div>
                <div class="error" id="historyError">Issue history is required.</div>
            </div>
            <div class="form-group">
                <label for="code">Code Context</label>
                <div class="input-group">
                    <i class="fas fa-code"></i>
                    <textarea id="code" name="code" rows="6" placeholder="Paste relevant code snippets or context"></textarea>
                </div>
                <div class="error" id="codeError">Code context is required.</div>
            </div>
            <button type="submit" id="submitBtn"><i class="fas fa-search"></i> Analyze Bug</button>
        </form>
        {% if result %}
        <div class="result">
            <h3><i class="fas fa-robot"></i> AI Analysis Result</h3>
            <pre>{{ result }}</pre>
        </div>
        {% endif %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('bugForm');
            const submitBtn = document.getElementById('submitBtn');
            const titleInput = document.getElementById('title');
            const historyTextarea = document.getElementById('history');
            const codeTextarea = document.getElementById('code');
            const titleError = document.getElementById('titleError');
            const historyError = document.getElementById('historyError');
            const codeError = document.getElementById('codeError');

            // Auto-resize textareas
            function autoResizeTextarea(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = textarea.scrollHeight + 'px';
            }

            historyTextarea.addEventListener('input', () => autoResizeTextarea(historyTextarea));
            codeTextarea.addEventListener('input', () => autoResizeTextarea(codeTextarea));

            // Form validation
            form.addEventListener('submit', function(e) {
                let isValid = true;

                // Reset errors
                titleError.style.display = 'none';
                historyError.style.display = 'none';
                codeError.style.display = 'none';

                // Check title
                if (!titleInput.value.trim()) {
                    titleError.style.display = 'block';
                    isValid = false;
                }

                // Check history
                if (!historyTextarea.value.trim()) {
                    historyError.style.display = 'block';
                    isValid = false;
                }

                // Check code
                if (!codeTextarea.value.trim()) {
                    codeError.style.display = 'block';
                    isValid = false;
                }

                if (!isValid) {
                    e.preventDefault();
                    return;
                }

                // Show loading state
                submitBtn.classList.add('loading');
                submitBtn.innerHTML = '<i class="fas fa-spinner"></i> Analyzing...';
                submitBtn.disabled = true;
            });

            // Remove loading state if form submission fails (e.g., on page reload)
            window.addEventListener('load', function() {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<i class="fas fa-search"></i> Analyze Bug';
                submitBtn.disabled = false;
            });
        });
    </script>
</body>
</html>